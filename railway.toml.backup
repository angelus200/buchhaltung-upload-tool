[build]
builder = "nixpacks"
buildCommand = "pnpm install && pnpm build"

[deploy]
startCommand = "pnpm start"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# Environment Variables Strategie
# Variablen werden in zwei Kategorien eingeteilt:
# 1. Build-Zeit: Benötigt während `pnpm build`
# 2. Laufzeit: Benötigt nur wenn der Server läuft

# WICHTIG: Railway erwartet standardmäßig dass alle process.env.* Referenzen
# im Code als "Secrets" definiert sind. Diese Config überschreibt das Verhalten
# für optionale Variablen.

# Build-Zeit Variablen (müssen gesetzt sein):
# - CLERK_PUBLISHABLE_KEY
# - CLERK_SECRET_KEY
# - DATABASE_URL

# Laufzeit Variablen (optional):
# - RESEND_API_KEY (für E-Mail Versand)
# - ANTHROPIC_API_KEY (für Claude AI Chat)
# - BUILT_IN_FORGE_API_URL (für OCR/Vision)
# - BUILT_IN_FORGE_API_KEY (für OCR/Vision)

[build.environment]
# Diese Variablen werden NUR zur Build-Zeit benötigt
NODE_ENV = "production"

# Frontend Build Variablen
VITE_CLERK_PUBLISHABLE_KEY = "${CLERK_PUBLISHABLE_KEY}"

# Hinweis: RESEND_API_KEY wird NICHT hier gelistet,
# weil es nur zur Laufzeit benötigt wird
